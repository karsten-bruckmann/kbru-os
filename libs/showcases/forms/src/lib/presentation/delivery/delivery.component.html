<div class="form-row">
    <ng-container #loginButton *ngIf="(user$ | async) === null; else logoutButton">
        <label>Already registered?</label>
        <button (click)="login()">
            Login
        </button>
    </ng-container>
    <ng-template #logoutButton>
        <label *ngIf="user$ | async as user">
            {{ user.zipCode }} {{ user.city }}<br />
            {{ user.street }}
        </label>
        <button (click)="logout()">
            Logout
        </button>
    </ng-template>
</div>

<form *ngIf="form$ | async as form" [formGroup]="form">
    <ng-container *ngIf="form.prop('visible')">
        <div
                *ngIf="form.get('address')?.prop('visible')"
                formGroupName="address"
        >
            <h3>Address</h3>

            <div class="form-row">
                <label>Zip Code</label>
                <input formControlName="zipCode"/>
            </div>

            <div class="form-row">
                <label>City</label>
                <select formControlName="city" *ngIf="form.get('address.city')?.prop('visible'); else cityValue">
                    <ng-container
                            *ngIf="form.get('address.city')?.prop('options') as options"
                    >
                        <option *ngIf="!form.get('address.city')?.value && !!form.get('address.city')?.enabled"
                                value="">
                            Please select...
                        </option>
                        <option *ngIf="!form.get('address.city')?.value && !!form.get('address.city')?.disabled"
                                value="">
                            Please enter a valid zip code first
                        </option>
                        <option *ngFor="let option of options"
                                [selected]="form.get('address.city')?.value === option">{{ option }}</option>
                    </ng-container>
                </select>
                <ng-template #cityValue>
                    <span class="value"
                          [class.disabled]="form.get('address.city')?.disabled">{{ form.get('address.city')?.value }}</span>
                </ng-template>
            </div>

            <div class="form-row">
                <label>Street / No.</label>
                <input formControlName="street"/>
            </div>
        </div>
    </ng-container>
</form>

<pre>{{ (form$ | async)?.value | json }}</pre>
